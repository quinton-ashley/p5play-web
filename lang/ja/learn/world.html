<!DOCTYPE html>
<html lang="ja" class="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>p5play : World</title>
	<link rel="icon" href="/assets/p5play_logo.svg">
	<link rel="stylesheet" href="/learn/style.css">
</head>

<body class="dark">
	<article style="display: none;">
		<nav id="topNav">
			<a href="index.html" id="logoLink" class="active">
				<img alt="p5play logo" src="/assets/p5play_logo.svg" class="p5play_logo">
				<span>p5play</span>
			</a>
			<hr>
			<a href="canvas.html">Canvas</a>
			<a href="sound.html">Sound</a>
			<a href="tiles.html">Tiles</a>
			<a href="world.html" class="active">World</a>
			<hr>
			<a id="darkMode" onclick="toggleDarkMode()" tabindex="0" role="button" title="dark mode toggle">
				<div id="darkModeIcon"></div>
			</a>
		</nav>
		<div class="break"></div>

		<div id="page-0" class="page">
			<div class="minis horiz">
				<md id="md0-0">
					<h2 id="ワールド">ワールド</h2>
					<p>p5play の各インスタンスには <code>world</code> （ワールド）オブジェクトが存在します。これは、 Box2D
						物理シミュレーションの制御に使われているオブジェクトです。なかでも重要なプロパティは <code>gravity</code> （重力）で、 x 成分の値と y 成分の値を持っています。
					</p>
					<p>この物理シミュレーションは、設定値が同じであれば、必ず同じ物理挙動を示すことに注意してください。つまり、同じコードを複数回実行しても、設定値にランダムな値を使わない限り、まったく同じ結果しか得られないのです！
					</p>
				</md>
				<md id="md0-1">
					<h2 id="スリープ">スリープ</h2>
					<p><code>world.allowSleeping</code> のデフォルト値は true です。</p>
					<p>スプライトは、動きが止まり、さらに新しくコリジョン起こらなくなると、「 sleeping
						（スリープ）」を開始します。「スリープ」中のスプライトは、物理シミュレーションの対象外となり、ほとんどの場合で Box2D
						物理エンジンはそのスプライトに対する計算処理を省略します。これによってパフォーマンスは向上しますが、ときに問題を引き起こしたりもします。</p>
					<p>スリープ中のスプライトは、 <code>sprite.sleeping</code> を false に設定することで、「目覚めさせる（スリープを解除する）」ことができます。また、
						<code>sprite.allowSleeping</code> を false に設定することで、スプライトごとにスリープ機能をを無効にすることもできます。</p>
				</md>
			</div>
			<div class="minis horiz">
				<script type="mie/p5" id="sleeping" horiz="">
let ball, floor;

function setup() {
	new Canvas(80, 240);
	world.gravity.y = 10;
	ball = new Sprite(40, 30, 50);
	floor = new Sprite(40, 155, 80, 5, 's');
}

function draw() {
	clear();
	if (frameCount == 100)	floor.rotation = 10;
}
				</script>
				<script type="mie/p5" id="wake-up!" horiz="">
let ball, floor;

function setup() {
	new Canvas(80, 256);
	world.gravity.y = 10;
	ball = new Sprite(40, 30, 50);
	floor = new Sprite(40, 155, 80, 5, 's');
}

function draw() {
	clear();
	if (frameCount == 100)	{
		ball.sleeping = false;
		floor.rotation = 10;
	}
}
				</script>
			</div>
		</div>
		<div id="page-1" class="page">
			<div class="minis horiz">
				<md id="md1-0">
					<h2 id="時間速度のコントロール">時間速度のコントロール</h2>
					<p><code>world.timeScale</code> （時間速度）係数は、デフォルトでは 1
						で、これは現実時間での物理シミュレーションの設定です。この値を小さくすると、動きはスローモーションになります。 0 にすると、時間は停止します！</p>
					<p>注意すべきは、 Box2D 物理エンジンのソルバ（計算器）が安定して動作可能な時間速度は、 2 が限界だということです。もし、物理シミュレーションの時間をさらに速く進めたい場合は、代わりに
						<code>world.step</code> 関数を複数回、実行してください。</p>
					<p>コードサンプルのキャンバスをクリックしてみてください。物理シミュレーションが実時間の 1/4
						のスローモーションで進みます。このときの、映画『マトリックス』の銃弾の残像のようなイフェクトは、フレームごとの背景の塗りつぶし色を、わずかに透明にすることで作ることができます。</p>
				</md>
			</div>
			<script type="mie/p5" id="Slow Motion">
let ball, box;
		
function setup() {
	new Canvas(500, 192);

	ball = new Sprite(250, 100, 20);
	ball.speed = 10;
	ball.direction = 45;
	ball.bounciness = 1;
	ball.friction = 0;
	ball.strokeWeight = 0;

	box = new Sprite(250, 96, 490, 180, 's');
	box.shape = 'chain';
}

function draw() {
	if (mouse.pressing()) {
		background(0, 0, 0, 30);
		world.timeScale = 0.25;
	} else {
		background(0);
		world.timeScale = 1;
	}
}
			</script>
		</div>
		<div id="page-2" class="page">
			<md id="md2-0">
				<h2 id="パフォーマンスのテスト">パフォーマンスのテスト</h2>
				<p><code>p5play.renderStats</code> を true に設定すると、描画されたスプライト数、ディスプレイのリフレッシュレート、 FPS
					の計算値を表示します。より包括的な結果を得るには、ウェブブラウザのパフォーマンステストツールを使用してください。</p>
				<p>ここでいう FPS とは、実際に画面にフレームが表示されるまでの遅延を除いた、「コンピュータが 1 秒間に生成できるフレーム数 (Frames Per Second) 」のことです。 FPS
					が高いほど、ゲームのパフォーマンスが高いことを意味します。</p>
				<p>一般に、スプライトの数が少なく、使用するキャンバスがより小さいほど、ゲームのパフォーマンスは向上します。さらに良好なパフォーマンスを得るには、p5.js の <code>clear</code>
					関数の使用や、 <code>canvas.get</code> でのキャンバスのピクセル色の取得を、避けるようにしてください。</p>
				<p>デフォルトでは、 Box2D の物理エンジンは <code>world.velocityIterations</code> （速度計算の反復）を 8 回、
					<code>world.positionIterations</code> （位置計算の反復）を 3
					回行います。これらの値を小さくすると、物理シミュレーション計算は速くなりますが、そのぶん精度は落ちます。</p>
				<p>さまざまなウェブブラウザで p5play をテストした結果、 Google Chrome が最もパフォーマンスに優れていることがわかりました。</p>
			</md>
			<script type="mie/p5" id="renderStats">
function setup() {
	new Canvas(500, 250);
	p5play.renderStats = true;

	for (let i = 0; i < 25; i++) {
		let x = 430 - i * 20;
		for (let j = 0; j < 20; j++) {
			new Sprite(x + j * 10, 5 + i * 10, 9, 9);
		}
	}
}

function draw() {
	background(20);

	world.velocityIterations = 8;
	world.positionIterations = 3;

	if (mouse.presses()) new Sprite(mouse.x, mouse.y, 25);
	if (mouse.pressing()) {
		allSprites.at(-1).moveTowards(mouse);
	}
}
			</script>
		</div>

		<div class="break"></div>
		<div id="toc">
			<a id="prevPage" class="navLink">前へ</a>
			<div id="pageNav" class="submenu">
				<a data-page="0" href="world.html?page=0">スリープ</a>
				<a data-page="1" href="world.html?page=1">時間速度のコントロール</a>
				<a data-page="2" href="world.html?page=2">パフォーマンスのテスト</a>
			</div>
			<a id="nextPage" class="navLink">次へ</a>
		</div>
		<div class="break"></div>
		<footer id="credits" class="text-small">制作・著作: クイントン・アシュリー（@quinton-ashley） ©2022-2024</footer>
	</article>

	<script src="/v3/q5.min.js"></script>
<script src="/v3/planck.min.js"></script>
<script src="/v3/p5play.min.js"></script>
<script>
window.mie = { autoLoad: false };

	</script>
	<script src="/learn/mie.js"></script>
<script src="/learn/learn.js"></script>
</body>

</html>
